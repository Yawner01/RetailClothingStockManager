<div class="container">
  <header class="header">
    <h1>Staff Panel</h1>
    <p>Manage products and categories.</p>
  </header>

  <!-- Analytics Section -->
   <section class="management-section">
    <div class="section-header"><h2>Analytics Dashboard</h2></div>
    <app-analytics-dashboard [userRole]="'Staff'"></app-analytics-dashboard>
  </section>

  <!-- Product Management Section -->
  <section class="management-section">
    <div class="section-header">
      <h2>Product Management</h2>
    </div>
    <div class="actions-section"><button *ngIf="!isAddProductVisible" (click)="showAddProductForm()"
        class="btn btn-primary">Add New Product</button>
      <div *ngIf="isAddProductVisible" class="form-container">
        <h3>Add New Product</h3>
        <form (ngSubmit)="addProduct()" #productForm="ngForm">
          <div class="form-field"><label for="name">Product Name:</label><input type="text" id="name" name="name"
              [(ngModel)]="newProduct.name" required></div>
          <div class="form-field"><label for="price">Price:</label><input type="number" id="price" name="price"
              [(ngModel)]="newProduct.price" required></div>
          <div class="form-field"><label for="quantity">Quantity:</label><input type="number" id="quantity"
              name="quantity" [(ngModel)]="newProduct.quantity" required></div>
          <div class="form-field"><label for="category">Category:</label><select id="category" name="category"
              [(ngModel)]="newProduct.categoryId" required>
              <option value="0" disabled>-- Select a Category --</option>
              <option *ngFor="let category of categories" [value]="category.categoryId">{{ category.catagoryName }}
              </option>
            </select>
            <div *ngIf="isLoadingCategories">Loading categories...</div>
          </div>
          <div class="form-buttons"><button type="submit" class="btn btn-success" [disabled]="!productForm.valid">Save
              Product</button><button type="button" (click)="isAddProductVisible = false"
              class="btn btn-secondary">Cancel</button></div>
        </form>
      </div>
    </div>

    <div class="section-header">
      <h3>Current Inventory</h3>
      <div class="filter-container">
          <label for="categoryFilter">Filter by Category:</label>
          <select id="categoryFilter" [(ngModel)]="selectedCategoryId" (ngModelChange)="onFilterChange()">
              <option [value]="0">All Categories</option>
              <option *ngFor="let cat of categories" [value]="cat.categoryId">{{ cat.catagoryName }}</option>
          </select>
      </div>
    </div>
    <div *ngIf="isLoadingProducts" class="loading-message">Loading products...</div>
    <p *ngIf="!isLoadingProducts && filteredProducts.length === 0" class="empty-message">No products match the selected filter.</p>
    
    <ul *ngIf="!isLoadingProducts && filteredProducts.length > 0" class="item-list">
      <li *ngFor="let product of filteredProducts">
        <!-- Display Mode -->
        <div *ngIf="!product.isEditing" class="item-content">
          <div class="item-info">
            <span class="item-name"><strong>{{ product.name }}</strong></span>
            <span class="item-detail">Category: {{ product.category?.catagoryName }}</span>
            <span class="item-detail">Price: ${{ product.price | number:'1.2-2' }}</span>
            <span class="item-detail">Quantity: {{ product.quantity }}</span>
            <span class="item-detail">Status: {{ product.status }}</span>
          </div>
          <div class="item-actions">
            <button *ngIf="product.quantity <= 5" 
                    (click)="requestStock(product)" 
                    [disabled]="product.isRequested"
                    class="btn btn-sm btn-warning">
              {{ product.isRequested ? 'Requested' : 'Request more stock' }}
            </button>
            <button (click)="startEditProduct(product)" class="btn btn-sm btn-primary">Edit</button>
            <button class="btn btn-sm btn-danger" disabled>Delete</button>
          </div>
        </div>
        <!-- Edit Mode -->
        <div *ngIf="product.isEditing" class="item-content edit-mode">
          <div class="edit-fields-vertical">
            <div class="form-field-inline"><label>Name:</label><input type="text" [(ngModel)]="product.name" class="form-control-sm"></div>
            <div class="form-field-inline"><label>Price:</label><input type="number" [(ngModel)]="product.price" class="form-control-sm"></div>
            <div class="form-field-inline"><label>Quantity:</label><input type="number" [(ngModel)]="product.quantity" class="form-control-sm"></div>
            <div class="form-field-inline"><label>Category:</label>
              <select [(ngModel)]="product.categoryId" class="form-control-sm">
                <option *ngFor="let cat of categories" [value]="cat.categoryId">{{ cat.catagoryName }}</option>
              </select>
            </div>
            <div class="form-field-inline"><label>Status:</label>
              <select [(ngModel)]="product.status" class="form-control-sm">
                <option value="In Stock">In Stock</option>
                <option value="Out of Stock">Out of Stock</option>
              </select>
            </div>
          </div>
          <div class="item-actions">
            <button (click)="saveProduct(product)" class="btn btn-sm btn-success">Save</button>
            <button (click)="cancelEditProduct(product)" class="btn btn-sm btn-secondary">Cancel</button>
          </div>
        </div>
      </li>
    </ul>
  </section>
</div>s